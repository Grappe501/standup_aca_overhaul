---
// src/layouts/SiteLayout.astro
// Stand Up Arkansas — ACA Overhaul (Congress-grade docs shell)

const {
  title = "Stand Up Arkansas — ACA Overhaul",
  description = "A people-first, plain-language proposal for modernizing the ACA with a durable Backbone that lowers costs and stabilizes care.",
  ogTitle,
  ogDescription,
  noIndex = false,
  showAnnouncement = true,
} = Astro.props;

const pageTitle = title;
const metaDescription = description;
const ogT = ogTitle ?? pageTitle;
const ogD = ogDescription ?? metaDescription;

// Navigation order supports the persuasion flow without labeling it.
const nav = [
  { href: "/", label: "Home" },
  { href: "/start-here", label: "Start Here" },
  { href: "/the-backbone", label: "The Backbone" },
  { href: "/proposal", label: "The Proposal" },
  { href: "/the-problem", label: "The Problem" },
  { href: "/congress", label: "For Congress" },
  { href: "/library", label: "Library" },
];

const pathname = Astro.url?.pathname ?? "/";
function isActive(href: string): boolean {
  if (href === "/") return pathname === "/";
  return pathname === href || pathname.startsWith(href + "/");
}
---

<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{pageTitle}</title>
    <meta name="description" content={metaDescription} />
    {noIndex ? <meta name="robots" content="noindex,nofollow" /> : null}

    <meta property="og:title" content={ogT} />
    <meta property="og:description" content={ogD} />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="theme-color" content="#070A12" />

    <link rel="icon" href="/favicon.svg" />
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />

    <!-- Prevent flash: apply theme before first paint -->
    <script is:inline>
      (function () {
        try {
          const stored = localStorage.getItem("theme");
          const prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;

          const theme = stored || (prefersDark ? "dark" : "light");
          document.documentElement.setAttribute("data-theme", theme);

          const meta = document.querySelector('meta[name="theme-color"]');
          if (meta) meta.setAttribute("content", theme === "dark" ? "#070A12" : "#F6F8FF");
        } catch (_) {}
      })();
    </script>

    <style>
      :root{
        /* ====== DARK TOKENS ====== */
        --bg0: 7 10 18;
        --bg1: 10 14 26;
        --bg2: 14 20 34;

        --fg: 236 240 249;
        --muted: 160 170 190;

        --brand: 99 102 241; /* indigo */
        --brand2: 34 197 94; /* green */
        --warn: 251 191 36;  /* amber */

        --border: 42 54 82;
        --ring: 99 102 241;

        --r-sm: 12px;
        --r-md: 16px;
        --r-lg: 20px;

        --shadow-sm: 0 10px 26px rgba(0,0,0,.22);
        --shadow-md: 0 22px 60px rgba(0,0,0,.32);

        --container: 1180px;

        /* Derived (contrast-safe) */
        --text: rgb(var(--fg));
        --text-muted: rgba(var(--fg), .80);
        --text-subtle: rgba(var(--fg), .64);

        --surface: rgba(var(--bg1), .72);
        --surface2: rgba(var(--bg2), .56);

        --stroke: rgba(var(--border), .55);
        --stroke-strong: rgba(var(--border), .78);

        --link: rgba(var(--brand), .96);

        --glass: rgba(7,10,18,.62);
        --hover: rgba(var(--bg2), .34);
        --hover-strong: rgba(var(--bg2), .48);
      }

      html[data-theme="light"]{
        /* ====== LIGHT TOKENS ====== */
        --bg0: 246 248 255;
        --bg1: 255 255 255;
        --bg2: 245 247 255;

        --fg: 18 24 40;
        --muted: 82 94 120;

        --border: 210 220 245;
        --ring: 99 102 241;

        --shadow-sm: 0 12px 28px rgba(16,24,40,.10);
        --shadow-md: 0 26px 70px rgba(16,24,40,.14);

        --text: rgb(var(--fg));
        --text-muted: rgba(var(--fg), .82);
        --text-subtle: rgba(var(--fg), .62);

        --surface: rgba(var(--bg1), .92);
        --surface2: rgba(var(--bg2), .86);

        --stroke: rgba(var(--border), .92);
        --stroke-strong: rgba(var(--border), 1);

        --link: rgba(var(--brand), .96);

        --glass: rgba(255,255,255,.74);
        --hover: rgba(var(--bg2), .70);
        --hover-strong: rgba(var(--bg2), .84);
      }

      *{ box-sizing:border-box; }
      html, body{ height:100%; }

      body{
        margin:0;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
        color: var(--text);
        line-height: 1.55;
        background: rgb(var(--bg0));
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Premium background fields */
      body:after{
        content:"";
        position:fixed;
        inset:0;
        pointer-events:none;
        z-index:-2;
        background:
          radial-gradient(1200px 600px at 15% -10%, rgba(99,102,241,.24), transparent 55%),
          radial-gradient(900px 520px at 85% 0%, rgba(34,197,94,.14), transparent 55%),
          radial-gradient(900px 520px at 50% 110%, rgba(99,102,241,.10), transparent 60%);
      }
      html[data-theme="light"] body:after{
        background:
          radial-gradient(1200px 600px at 12% -10%, rgba(99,102,241,.16), transparent 55%),
          radial-gradient(900px 520px at 85% 0%, rgba(34,197,94,.10), transparent 55%),
          radial-gradient(900px 520px at 50% 110%, rgba(99,102,241,.08), transparent 60%);
      }

      /* subtle noise overlay */
      body:before{
        content:"";
        position:fixed;
        inset:0;
        pointer-events:none;
        opacity:.06;
        mix-blend-mode:overlay;
        background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.45'/%3E%3C/svg%3E");
        background-size: 240px 240px;
      }
      html[data-theme="light"] body:before{
        opacity:.045;
        mix-blend-mode:multiply;
      }

      a{ color: inherit; }

      .container{
        max-width: var(--container);
        margin:0 auto;
        padding: 0 22px;
      }

      :focus-visible{
        outline:none;
        box-shadow: 0 0 0 4px rgba(var(--ring), .22), 0 0 0 1px rgba(var(--ring), .62);
        border-radius: 12px;
      }

      /* Header */
      .topbar{
        position: sticky;
        top: 0;
        z-index: 80;
        backdrop-filter: blur(14px);
        background: var(--glass);
        border-bottom: 1px solid var(--stroke);
      }

      .headerRow{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 14px;
        padding: 14px 22px;
      }

      .brand{
        display:flex;
        align-items:center;
        gap: 12px;
        text-decoration:none;
        min-width: 220px;
      }

      .mark{
        width: 36px;
        height: 36px;
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(99,102,241,1), rgba(34,197,94,1));
        box-shadow: var(--shadow-sm);
      }

      .brandTitle{
        display:flex;
        flex-direction:column;
        gap:2px;
        line-height:1.2;
      }
      .brandTitle strong{
        font-size: 14px;
        letter-spacing: .2px;
        color: var(--text);
      }
      .brandTitle span{
        font-size: 12px;
        color: var(--text-subtle);
      }

      nav.primary{
        display:flex;
        align-items:center;
        gap: 6px;
        flex-wrap: wrap;
        justify-content:center;
      }

      nav.primary a{
        font-size: 13px;
        text-decoration:none;
        padding: 10px 12px;
        border-radius: 999px;
        color: var(--text-muted);
        border: 1px solid transparent;
        transition: transform .12s ease, background .12s ease, border-color .12s ease, color .12s ease;
      }
      nav.primary a:hover{
        background: var(--hover);
        border-color: var(--stroke);
        color: var(--text);
        transform: translateY(-1px);
      }
      nav.primary a[data-active="true"]{
        background: linear-gradient(135deg, rgba(99,102,241,.18), rgba(34,197,94,.08));
        border-color: rgba(99,102,241,.45);
        color: var(--text);
      }

      .cta{
        display:flex;
        align-items:center;
        gap: 10px;
      }

      .btn{
        display:inline-flex;
        align-items:center;
        gap: 10px;
        padding: 10px 14px;
        border-radius: 999px;
        text-decoration:none;
        font-size: 13px;
        border: 1px solid var(--stroke-strong);
        background: var(--surface);
        box-shadow: var(--shadow-sm);
        transition: transform .12s ease, border-color .12s ease, background .12s ease;
        white-space: nowrap;
        color: var(--text);
      }
      .btn:hover{
        transform: translateY(-1px);
        border-color: rgba(var(--ring), .55);
        background: var(--hover-strong);
      }
      .btn.primary{
        border-color: rgba(var(--ring), .65);
        background: linear-gradient(135deg, rgba(99,102,241,.26), rgba(34,197,94,.10));
      }

      /* Icon buttons (theme + menu) */
      .iconButton{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: 1px solid var(--stroke-strong);
        background: var(--surface);
        box-shadow: var(--shadow-sm);
        cursor:pointer;
        transition: transform .12s ease, border-color .12s ease, background .12s ease;
        color: var(--text);
      }
      .iconButton:hover{
        transform: translateY(-1px);
        border-color: rgba(var(--ring), .55);
        background: var(--hover-strong);
      }

      .menuBtn{ display:none; } /* shown on mobile */

      .announcement{
        border-top: 1px solid var(--stroke);
        background: var(--surface2);
        color: var(--text-muted);
        font-size: 13px;
      }
      .announcementInner{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 10px;
        padding: 10px 22px;
      }
      .pill{
        display:inline-flex;
        align-items:center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--stroke);
        background: var(--surface);
        font-size: 12px;
        color: var(--text-muted);
        white-space: nowrap;
      }
      /* Scope the announcement dot so it doesn't collide with page-level .dot patterns */
      .announcement .dot{
        width: 8px; height: 8px;
        border-radius: 999px;
        background: rgba(var(--warn), .95);
        box-shadow: 0 0 0 6px rgba(var(--warn), .12);
        flex: 0 0 auto;
      }

      /* Mobile drawer */
      .drawerBackdrop{
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.55);
        backdrop-filter: blur(6px);
        display:none;
        z-index: 200;
      }
      html[data-theme="light"] .drawerBackdrop{
        background: rgba(15, 23, 42, .35);
      }

      .drawer{
        position: fixed;
        top: 0; right: 0;
        height: 100%;
        width: min(92vw, 360px);
        background: var(--surface);
        border-left: 1px solid var(--stroke-strong);
        box-shadow: var(--shadow-md);
        transform: translateX(100%);
        transition: transform .18s ease;
        z-index: 220;
        padding: 18px;
        display:flex;
        flex-direction: column;
        gap: 14px;
        backdrop-filter: blur(14px);
      }
      .drawerBackdrop[data-open="true"]{ display:block; }
      .drawer[data-open="true"]{ transform: translateX(0); }

      .drawerHeader{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 10px;
      }
      .drawerNav{
        display:flex;
        flex-direction: column;
        gap: 6px;
        padding-top: 6px;
      }
      .drawerNav a{
        text-decoration:none;
        padding: 12px 12px;
        border-radius: 14px;
        border: 1px solid var(--stroke);
        background: var(--surface2);
        color: var(--text);
      }
      .drawerNav a:hover{
        border-color: rgba(var(--ring), .55);
        background: var(--hover-strong);
      }
      .drawerNav a[data-active="true"]{
        border-color: rgba(var(--ring), .55);
        background: linear-gradient(135deg, rgba(99,102,241,.20), rgba(34,197,94,.08));
      }

      main{
        padding: 30px 0 72px;
      }

      /* Cards */
      .card{
        border: 1px solid var(--stroke);
        background: var(--surface);
        border-radius: var(--r-lg);
        box-shadow: var(--shadow-sm);
      }

      /* Prose */
      .prose{
        max-width: 920px;
        font-size: 16px;
      }
      .prose h1{
        font-size: 40px;
        letter-spacing: -0.02em;
        line-height: 1.12;
        margin: 0 0 14px;
        color: var(--text);
      }
      .prose h2{
        font-size: 24px;
        letter-spacing: -0.01em;
        margin: 28px 0 10px;
        color: var(--text);
      }
      .prose h3{
        font-size: 18px;
        margin: 20px 0 8px;
        color: var(--text);
      }
      .prose p, .prose li{
        color: var(--text-muted);
      }
      .prose a{
        color: var(--link);
        text-decoration: none;
        border-bottom: 1px solid rgba(var(--ring), .35);
      }
      .prose a:hover{
        border-bottom-color: rgba(var(--ring), .75);
      }
      .prose code{
        background: var(--surface2);
        padding: 2px 7px;
        border-radius: 10px;
        border: 1px solid var(--stroke);
        color: var(--text);
      }
      .prose blockquote{
        margin: 18px 0;
        padding: 14px 16px;
        border-left: 3px solid rgba(var(--ring), .85);
        background: var(--surface);
        border-radius: 16px;
        color: var(--text-muted);
      }
      .prose hr{
        border: none;
        border-top: 1px solid var(--stroke);
        margin: 26px 0;
      }
      .prose table{
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border: 1px solid var(--stroke);
        border-radius: 16px;
        overflow: hidden;
        background: var(--surface);
        margin: 18px 0;
      }
      .prose th, .prose td{
        padding: 12px 12px;
        border-bottom: 1px solid var(--stroke);
        vertical-align: top;
        color: var(--text-muted);
      }
      .prose th{
        text-align:left;
        font-size: 13px;
        color: var(--text);
        background: var(--surface2);
      }
      .prose tr:last-child td{ border-bottom: none; }

      /* Footer */
      .footer{
        border-top: 1px solid var(--stroke);
        padding: 30px 0 48px;
        color: var(--text-subtle);
        font-size: 13px;
      }
      .footerInner{
        display:flex;
        flex-wrap:wrap;
        gap: 14px;
        align-items:center;
        justify-content:space-between;
      }
      .footer a{
        color: var(--text-muted);
        text-decoration:none;
        border-bottom: 1px solid transparent;
      }
      .footer a:hover{
        border-bottom-color: rgba(var(--fg), .25);
      }

      @media (max-width: 980px){
        nav.primary{ display:none; }
        .menuBtn{ display:inline-flex; }
      }
    </style>
  </head>

  <body>
    <header class="topbar">
      <div class="container headerRow">
        <a class="brand" href="/">
          <span class="mark" aria-hidden="true"></span>
          <div class="brandTitle">
            <strong>Stand Up Arkansas</strong>
            <span>ACA Overhaul — People-first proposal</span>
          </div>
        </a>

        <nav class="primary" aria-label="Primary navigation">
          {nav.map((item) => (
            <a href={item.href} data-active={isActive(item.href) ? "true" : "false"}>
              {item.label}
            </a>
          ))}
        </nav>

        <div class="cta">
          <a class="btn" href="/start-here">Start here</a>
          <a class="btn primary" href="/proposal">The Proposal</a>

          <button
            class="iconButton"
            type="button"
            aria-label="Toggle theme"
            aria-pressed="true"
            data-theme-toggle
          >
            <svg data-icon-sun width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:none;">
              <path d="M12 18a6 6 0 1 0 0-12 6 6 0 0 0 0 12Z" stroke="currentColor" stroke-width="2"/>
              <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <svg data-icon-moon width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M21 13.2A8.2 8.2 0 1 1 10.8 3a6.6 6.6 0 0 0 10.2 10.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </button>

          <button class="iconButton menuBtn" type="button" aria-label="Open menu" data-menu-open>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>

      {showAnnouncement ? (
        <div class="announcement">
          <div class="container announcementInner">
            <div style="display:flex; align-items:center; gap: 10px;">
              <span class="dot" aria-hidden="true"></span>
              <div>
                <strong>Draft:</strong> This site is being refined for clarity, durability, and congressional review.
              </div>
            </div>
            <span class="pill">Working build</span>
          </div>
        </div>
      ) : null}
    </header>

    <!-- Mobile drawer -->
    <div class="drawerBackdrop" data-backdrop></div>
    <aside class="drawer" aria-label="Mobile navigation" data-drawer>
      <div class="drawerHeader">
        <div style="display:flex; align-items:center; gap: 10px;">
          <span class="mark" aria-hidden="true" style="width:30px;height:30px;border-radius:10px;"></span>
          <div class="brandTitle">
            <strong>Stand Up Arkansas</strong>
            <span>Navigate</span>
          </div>
        </div>
        <button class="iconButton" type="button" aria-label="Close menu" data-menu-close>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="drawerNav">
        {nav.map((item) => (
          <a href={item.href} data-active={isActive(item.href) ? "true" : "false"}>
            {item.label}
          </a>
        ))}
      </div>

      <div style="margin-top:auto; display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn" href="/library">Library</a>
        <a class="btn primary" href="/proposal">The Proposal</a>
      </div>
    </aside>

    <main>
      <div class="container">
        <slot />
      </div>
    </main>

    <footer class="footer">
      <div class="container footerInner">
        <div>
          <div style="color: var(--text); font-weight: 650;">Stand Up Arkansas</div>
          <div>standuparkansas.com • “ACA for the People”</div>
        </div>
        <div style="display:flex; gap: 12px; flex-wrap:wrap;">
          <a href="/start-here">Start Here</a>
          <a href="/the-backbone">The Backbone</a>
          <a href="/proposal">The Proposal</a>
          <a href="/congress">For Congress</a>
          <a href="/library">Library</a>
        </div>
      </div>
    </footer>

    <script is:inline>
      // Mobile drawer
      const openBtn = document.querySelector("[data-menu-open]");
      const closeBtn = document.querySelector("[data-menu-close]");
      const backdrop = document.querySelector("[data-backdrop]");
      const drawer = document.querySelector("[data-drawer]");

      function setOpen(open) {
        if (!backdrop || !drawer) return;
        backdrop.dataset.open = open ? "true" : "false";
        drawer.dataset.open = open ? "true" : "false";
        document.body.style.overflow = open ? "hidden" : "";
        if (open) closeBtn?.focus();
      }

      openBtn?.addEventListener("click", () => setOpen(true));
      closeBtn?.addEventListener("click", () => setOpen(false));
      backdrop?.addEventListener("click", () => setOpen(false));
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") setOpen(false);
      });
      drawer?.querySelectorAll("a").forEach((a) => a.addEventListener("click", () => setOpen(false)));

      // Theme toggle (persisted)
      const themeToggle = document.querySelector("[data-theme-toggle]");
      const sun = themeToggle?.querySelector("[data-icon-sun]");
      const moon = themeToggle?.querySelector("[data-icon-moon]");

      function getTheme() {
        return document.documentElement.getAttribute("data-theme") || "dark";
      }

      function applyTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        try { localStorage.setItem("theme", theme); } catch (_) {}

        const meta = document.querySelector('meta[name="theme-color"]');
        if (meta) meta.setAttribute("content", theme === "dark" ? "#070A12" : "#F6F8FF");

        const isDark = theme === "dark";
        if (sun && moon) {
          moon.style.display = isDark ? "block" : "none";
          sun.style.display = isDark ? "none" : "block";
        }
        if (themeToggle) {
          // pressed = dark mode enabled
          themeToggle.setAttribute("aria-pressed", isDark.toString());
        }
      }

      // Initialize icons based on current theme set by the pre-paint script
      applyTheme(getTheme());

      themeToggle?.addEventListener("click", () => {
        const next = getTheme() === "dark" ? "light" : "dark";
        applyTheme(next);
      });
    </script>
  </body>
</html>
